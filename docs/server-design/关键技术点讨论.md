# MCP Server å…³é”®æŠ€æœ¯ç‚¹è®¨è®º

## æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**: 2025-02-14
- **æ›´æ–°æ—¥æœŸ**: 2025-02-14
- **çŠ¶æ€**: è®¨è®ºä¸­
- **ç›¸å…³æ–‡æ¡£**: [æ•´ä½“æ¶æ„è®¾è®¡.md](../æ•´ä½“æ¶æ„è®¾è®¡.md)

---

## ä¸€ã€æ ¸å¿ƒå†³ç­–

### 1. æ¶æ„å®šä½

| å†³ç­–é¡¹ | ç»“è®º |
|--------|------|
| **æœåŠ¡æ€§è´¨** | ç‹¬ç«‹çš„ D&D 5e æ¸¸æˆå¼•æ“åç«¯ |
| **åè®®** | MCP åè®®ï¼ŒHTTP ä¼ è¾“ |
| **ä½¿ç”¨è€…** | é€šç”¨è®¾è®¡ï¼Œå¯è¢«ä»»æ„ MCP Client ä½¿ç”¨ï¼ˆæˆ‘ä»¬çš„ Clientã€Claude Desktop ç­‰ï¼‰ |
| **éƒ¨ç½²å½¢æ€** | ç‹¬ç«‹æœåŠ¡è¿›ç¨‹ |

### 2. æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¸Šä¸‹æ–‡ç®¡ç†å±‚ (Context)          â”‚
â”‚  ä¼šè¯ç®¡ç†ã€å¯¹è¯å­˜å‚¨ã€MCPé€‚é…ã€æŒä¹…åŒ–   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        è§„åˆ™å¼•æ“å±‚ (Rules Engine)      â”‚
â”‚  è§’è‰²ã€æˆ˜æ–—ã€éª°å­/è§„åˆ™ã€åœ°å›¾ã€çŠ¶æ€     â”‚
â”‚  ï¼ˆçº¯é€»è¾‘ã€æ— çŠ¶æ€ã€å¯ç‹¬ç«‹æµ‹è¯•ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡æ„å›¾**ï¼š
- è§„åˆ™å¼•æ“ä¸å…³å¿ƒ"è°åœ¨ç”¨"ã€"æ•°æ®å­˜å“ª"ï¼Œå¯ç‹¬ç«‹æµ‹è¯•å’Œå¤ç”¨
- ä¸Šä¸‹æ–‡ç®¡ç†ä½œä¸ºé€‚é…å±‚ï¼Œå¤„ç†åè®®ã€å­˜å‚¨ã€ä¼šè¯

### 3. è§„åˆ™ä¸æ•°æ®

| å†³ç­–é¡¹ | ç»“è®º |
|--------|------|
| **è§„åˆ™è¦†ç›–** | æœ€ç»ˆå®Œæ•´ 5eï¼Œå¼€å‘å¾ªåºæ¸è¿›ï¼ˆå…ˆæ ¸å¿ƒåå®Œæ•´ï¼‰ |
| **è§„åˆ™å†²çª** | æš‚ä¸è€ƒè™‘ï¼Œå†…ç½®ä¸€å¥—è§„åˆ™ |
| **é™æ€æ•°æ®** | ä½¿ç”¨å®Œæ•´ RAG åº“ï¼ˆæ³•æœ¯ã€ç‰©å“ã€æ€ªç‰©ç­‰ï¼‰ |
| **æˆ˜æ–— AI** | ç”± Client çš„ LLM å†³å®šï¼ŒServer ä¸è´Ÿè´£ |

### 4. ä¼šè¯ä¸å­˜å‚¨

| å†³ç­–é¡¹ | ç»“è®º |
|--------|------|
| **å¤šä¼šè¯** | æ”¯æŒï¼Œsession_id éš”ç¦» |
| **å…¸å‹åœºæ™¯** | ä¸€ä¸ª Serverï¼Œ2-3 ä¼šè¯ï¼Œ1-2 æ´»è·ƒ |
| **æ•°æ®åº“** | PostgreSQL |
| **å®æ—¶æ¨é€** | ä¸éœ€è¦ï¼Œå›åˆåˆ¶è°ƒç”¨æ¨¡å¼ |

### 5. å¯¹è¯ä¸ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆâœ… å·²å†³ç­–ï¼‰

| å†³ç­–é¡¹ | ç»“è®º |
|--------|------|
| **å¯¹è¯å†å²å­˜å‚¨ä½ç½®** | Server ç»Ÿä¸€å­˜å‚¨ |
| **Client æ˜¯å¦å­˜å‚¨** | ä¸å­˜å‚¨ï¼ˆå¯é€‰ç¼“å­˜ï¼‰ |
| **å­˜æ¡£ç²’åº¦** | è‡ªåŠ¨å­˜æ¡£ï¼ˆæ¯æ¡æ¶ˆæ¯ï¼‰ |
| **Server LLM ä¾èµ–** | ä¸ä¾èµ–ï¼Œä¿æŒç®€å• |
| **ä¸Šä¸‹æ–‡å‹ç¼©ç­–ç•¥** | Server æä¾›ç®€å•ç­–ç•¥ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ï¼Œé«˜çº§å‹ç¼©ç”± Client è‡ªè¡Œå¤„ç† |
| **é»˜è®¤çª—å£å¤§å°** | 20 æ¡æ¶ˆæ¯ |

**è®¾è®¡ç†ç”±**ï¼š
- Server ç»Ÿä¸€å­˜å‚¨å¯ç¡®ä¿å¤š Client æ•°æ®ä¸€è‡´æ€§
- ç®€åŒ– Client å®ç°ï¼ŒClient å˜æˆçº¯åè°ƒå±‚
- Server ä¸ä¾èµ– LLMï¼Œä¿æŒè½»é‡
- å®Œæ•´ Client å¯è·å–åŸå§‹æ•°æ®è‡ªè¡Œå¤„ç†ï¼Œç®€åŒ– Client ä½¿ç”¨é»˜è®¤æ»‘åŠ¨çª—å£

### 6. äº¤äº’æµç¨‹

#### 6.1 æ•´ä½“æµç¨‹

```
ç”¨æˆ·è¾“å…¥ â†’ Client è·å–ä¸Šä¸‹æ–‡ â†’ LLM å†³ç­– â†’ è°ƒç”¨ MCP Tool â†’ è§„åˆ™å¼•æ“æ‰§è¡Œ â†’ ä¿å­˜å¯¹è¯ â†’ è¿”å›ç»“æœ
```

æ ¸å¿ƒç‰¹ç‚¹ï¼š
- Server æ˜¯**è¢«åŠ¨å“åº”**çš„ï¼Œç”± Client é©±åŠ¨æ•´ä¸ªæµç¨‹
- æ¯æ¬¡å·¥å…·è°ƒç”¨æ˜¯**è¯·æ±‚-å“åº”**æ¨¡å¼ï¼Œä¸éœ€è¦ Server ä¸»åŠ¨æ¨é€
- **å¯¹è¯å†å²ç”± Server ç»Ÿä¸€å­˜å‚¨**

#### 6.2 è¯¦ç»†æ•°æ®æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®Œæ•´äº¤äº’æµç¨‹                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·                    Client                      Server                 LLM
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚  1. ç”¨æˆ·è¾“å…¥            â”‚                           â”‚                    â”‚
  â”‚  "æˆ‘è¦æ”»å‡»å“¥å¸ƒæ—"       â”‚                           â”‚                    â”‚
  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                           â”‚                    â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚  2. è·å–ä¸Šä¸‹æ–‡             â”‚                    â”‚
  â”‚                        â”‚  get_context(session_id)  â”‚                    â”‚
  â”‚                        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚                    â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚                           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚                        â”‚                           â”‚ â”‚ ä¸Šä¸‹æ–‡ç®¡ç†å™¨    â”‚ â”‚
  â”‚                        â”‚                           â”‚ â”‚                â”‚ â”‚
  â”‚                        â”‚                           â”‚ â”‚ 1. è¯»å–å¯¹è¯å†å² â”‚ â”‚
  â”‚                        â”‚                           â”‚ â”‚ 2. è¯»å–æ¸¸æˆçŠ¶æ€ â”‚ â”‚
  â”‚                        â”‚                           â”‚ â”‚ 3. æ»‘åŠ¨çª—å£å‹ç¼© â”‚ â”‚
  â”‚                        â”‚                           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚  3. è¿”å›å‹ç¼©åçš„ä¸Šä¸‹æ–‡     â”‚                    â”‚
  â”‚                        â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                    â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚  4. æ„å»º Promptï¼Œè°ƒç”¨ LLM  â”‚                    â”‚
  â”‚                        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚  5. LLM è¿”å›              â”‚                    â”‚
  â”‚                        â”‚  (å¯èƒ½åŒ…å« Tool Call)     â”‚                    â”‚
  â”‚                        â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚  6. å¦‚æœæœ‰ Tool Call      â”‚                    â”‚
  â”‚                        â”‚  æ‰§è¡Œ MCP Tool            â”‚                    â”‚
  â”‚                        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚                    â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚                           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚                        â”‚                           â”‚ â”‚ è§„åˆ™å¼•æ“æ‰§è¡Œ    â”‚ â”‚
  â”‚                        â”‚                           â”‚ â”‚ æ›´æ–°æ¸¸æˆçŠ¶æ€    â”‚ â”‚
  â”‚                        â”‚                           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚  7. è¿”å›æ‰§è¡Œç»“æœ          â”‚                    â”‚
  â”‚                        â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                    â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚                        â”‚  8. ä¿å­˜å¯¹è¯              â”‚                    â”‚
  â”‚                        â”‚  save_message(user_msg)   â”‚                    â”‚
  â”‚                        â”‚  save_message(ai_reply)   â”‚                    â”‚
  â”‚                        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚                    â”‚
  â”‚                        â”‚                           â”‚                    â”‚
  â”‚  9. è¿”å›ç»“æœç»™ç”¨æˆ·      â”‚                           â”‚                    â”‚
  â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚                    â”‚
```

#### 6.3 ä¸¤ç§ Client æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸¤ç§ Client æ¨¡å¼                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¨¡å¼ Aï¼šå®Œæ•´ Clientï¼ˆæˆ‘ä»¬çš„ Clientï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client                                      Server                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ æœ‰ LLM èƒ½åŠ›         â”‚                     â”‚ æ—  LLM ä¾èµ–        â”‚          â”‚
â”‚  â”‚                    â”‚                     â”‚                    â”‚          â”‚
â”‚  â”‚ 1. è·å–åŸå§‹æ•°æ®     â”‚ get_raw_context()  â”‚ è¿”å›ï¼š              â”‚          â”‚
â”‚  â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ - æ¸¸æˆçŠ¶æ€          â”‚          â”‚
â”‚  â”‚                    â”‚                     â”‚ - å¯¹è¯å†å²ï¼ˆåŸå§‹ï¼‰  â”‚          â”‚
â”‚  â”‚ 2. è‡ªå·±å‹ç¼©         â”‚                     â”‚                    â”‚          â”‚
â”‚  â”‚    (ç”¨è‡ªå·±çš„LLM)    â”‚                     â”‚                    â”‚          â”‚
â”‚  â”‚ 3. è°ƒç”¨ LLM å¯¹è¯    â”‚                     â”‚                    â”‚          â”‚
â”‚  â”‚ 4. ä¿å­˜ç»“æœ         â”‚ save_message()     â”‚                    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¨¡å¼ Bï¼šç®€åŒ– Clientï¼ˆClaude Desktop ç­‰ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client                                      Server                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ åªæœ‰ LLM èƒ½åŠ›       â”‚                     â”‚ æ—  LLM ä¾èµ–        â”‚          â”‚
â”‚  â”‚ æ— å‹ç¼©èƒ½åŠ›          â”‚                     â”‚ æä¾›ç®€å•ç­–ç•¥        â”‚          â”‚
â”‚  â”‚                    â”‚                     â”‚                    â”‚          â”‚
â”‚  â”‚ 1. è·å–ä¸Šä¸‹æ–‡       â”‚ get_context()      â”‚ ä½¿ç”¨ç®€å•ç­–ç•¥ï¼š      â”‚          â”‚
â”‚  â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ - æ»‘åŠ¨çª—å£ï¼ˆæœ€è¿‘Næ¡ï¼‰â”‚          â”‚
â”‚  â”‚                    â”‚                     â”‚ - é»˜è®¤ 20 æ¡        â”‚          â”‚
â”‚  â”‚ 2. è°ƒç”¨ LLM å¯¹è¯    â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚          â”‚
â”‚  â”‚ 3. ä¿å­˜ç»“æœ         â”‚ save_message()     â”‚                    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€MCP Tools è®¾è®¡ï¼ˆâœ… å·²å®šç¨¿ï¼‰

> ä» Client è°ƒç”¨è§’åº¦è®¾è®¡ï¼ŒæŒ‰ä¸šåŠ¡åœºæ™¯ç»„ç»‡ã€‚Server å†…éƒ¨å®ç°ï¼ˆå¦‚å¯¹è¯å­˜å‚¨ã€ä¸Šä¸‹æ–‡æ„å»ºï¼‰ä¸æš´éœ²ä¸º MCP Toolsã€‚

### 1. æˆ˜å½¹ç®¡ç†ï¼ˆCampaignï¼‰

```go
// åˆ›å»ºæˆ˜å½¹
create_campaign(name: string, settings?: object) â†’ campaign_id

// è·å–æˆ˜å½¹ä¿¡æ¯
get_campaign(campaign_id: string) â†’ campaign_info

// åˆ—å‡ºæ‰€æœ‰æˆ˜å½¹
list_campaigns() â†’ [campaign_info]

// åˆ é™¤æˆ˜å½¹
delete_campaign(campaign_id: string) â†’ void

// è·å–æˆ˜å½¹æ‘˜è¦ï¼ˆç”¨äº LLM ä¸Šä¸‹æ–‡ï¼‰
get_campaign_summary(campaign_id: string) â†’ summary
  // åŒ…å«ï¼šæ¸¸æˆæ—¶é—´ã€é˜Ÿä¼ä½ç½®ã€å½“å‰çŠ¶æ€ã€æœ€è¿‘äº‹ä»¶ç­‰
  // å¯¹è¯å†å²è‡ªåŠ¨ç”± Server ç®¡ç†ï¼Œæ­¤å¤„è¿”å›å‹ç¼©åçš„æ‘˜è¦
```

### 2. è§’è‰²ç®¡ç†ï¼ˆCharacterï¼‰- åŒ…å« NPC

```go
// åˆ›å»ºè§’è‰²/å³å…´ NPC
create_character(campaign_id: string, data: object) â†’ character_id
  // data.is_npc: booleanï¼ˆé»˜è®¤ falseï¼‰
  // data.npc_type: "scripted" | "generated"ï¼ˆä»… NPC ä½¿ç”¨ï¼‰

// è·å–è§’è‰²ä¿¡æ¯
get_character(character_id: string) â†’ character_info

// æ›´æ–°è§’è‰²
update_character(character_id: string, data: object) â†’ void

// åˆ—å‡ºè§’è‰²
list_characters(campaign_id: string, filter?: object) â†’ [character_info]
  // filter.is_npc: booleanï¼ˆå¯é€‰ï¼Œç­›é€‰ç©å®¶è§’è‰²æˆ– NPCï¼‰

// åˆ é™¤è§’è‰²
delete_character(character_id: string) â†’ void
```

**NPC è¯´æ˜**ï¼š
- NPC ä¸ç©å®¶è§’è‰²å…±äº«æ•°æ®ç»“æ„ï¼Œé€šè¿‡ `is_npc` å­—æ®µåŒºåˆ†
- å‰§æœ¬å›ºå®š NPCï¼šåˆ›å»ºæˆ˜å½¹æ—¶è‡ªåŠ¨åŠ è½½ï¼Œ`npc_type = "scripted"`
- LLM å³å…´ NPCï¼šé€šè¿‡ `create_character` åˆ›å»ºï¼Œ`npc_type = "generated"`

### 3. éª°å­/æ£€å®šï¼ˆDice & Checkï¼‰

```go
// æŠ•éª°å­
roll_dice(formula: string) â†’ roll_result
  // formula: "1d20+5", "2d6", "4d6kh3" ç­‰

// å±æ€§/æŠ€èƒ½æ£€å®š
roll_check(character_id: string, ability: string) â†’ check_result
  // ability: "strength", "stealth", "perception" ç­‰

// è±å…æ£€å®š
roll_save(character_id: string, save_type: string) â†’ save_result
  // save_type: "strength", "dexterity", "constitution" ç­‰
```

### 4. æˆ˜æ–—æ“ä½œï¼ˆCombatï¼‰

```go
// å¼€å§‹æˆ˜æ–—ï¼ˆè‡ªåŠ¨æŠ•å…ˆæ”»å¹¶æ’åºï¼‰
start_combat(campaign_id: string, participant_ids: [string]) â†’ combat_state
  // è¿”å›åŒ…å«ï¼šturn_orderï¼ˆå›åˆé¡ºåºï¼‰ã€current_turnã€round

// è·å–æˆ˜æ–—çŠ¶æ€
get_combat_state(campaign_id: string) â†’ combat_state
  // åŒ…å«ï¼šcurrent_turnï¼ˆå½“å‰æ˜¯è°çš„å›åˆï¼‰ã€turn_orderã€roundã€participants

// æ”»å‡»
attack(attacker_id: string, target_id: string, weapon?: string) â†’ attack_result
  // è¿”å›åŒ…å«ï¼šhitï¼ˆæ˜¯å¦å‘½ä¸­ï¼‰ã€damageï¼ˆä¼¤å®³å€¼ï¼‰ã€target_hpï¼ˆç›®æ ‡å‰©ä½™ HPï¼‰

// æ–½æ³•
cast_spell(caster_id: string, spell_id: string, targets: [string]) â†’ spell_result

// ç»“æŸå½“å‰å›åˆ
end_turn(campaign_id: string) â†’ combat_state
  // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€ä¸ªè§’è‰²çš„å›åˆï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªåˆ™ round++

// ç»“æŸæˆ˜æ–—
end_combat(campaign_id: string) â†’ void
```

**å›åˆç®¡ç†è¯´æ˜**ï¼š
- `start_combat` è‡ªåŠ¨ä¸ºæ‰€æœ‰å‚ä¸è€…æŠ•å…ˆæ”»å¹¶æ’åº
- `get_combat_state` è¿”å›å½“å‰å›åˆä¿¡æ¯ï¼ŒClient æ®æ­¤åˆ¤æ–­è½®åˆ°è°
- `end_turn` ç»“æŸå½“å‰å›åˆï¼Œè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€ä¸ª

### 5. åœ°å›¾/ç§»åŠ¨ï¼ˆMap & Movementï¼‰

```go
// è·å–å¤§åœ°å›¾
get_world_map(campaign_id: string) â†’ world_map

// åœ¨å¤§åœ°å›¾ç§»åŠ¨ï¼ˆè‡ªåŠ¨æ¶ˆè€—æ—¶é—´ï¼‰
move_to(campaign_id: string, location_id: string) â†’ move_result

// è¿›å…¥æˆ˜æ–—åœ°å›¾
enter_battle_map(campaign_id: string, location_id: string, battle_map_id?: string) â†’ battle_map

// è·å–å½“å‰æˆ˜æ–—åœ°å›¾
get_battle_map(campaign_id: string) â†’ battle_map

// ç§»åŠ¨ Tokenï¼ˆæˆ˜æ–—åœ°å›¾å†…ï¼‰
move_token(campaign_id: string, token_id: string, position: object) â†’ move_result

// ç¦»å¼€æˆ˜æ–—åœ°å›¾
exit_battle_map(campaign_id: string) â†’ void
```

**åœ°å›¾åˆ‡æ¢è¯´æ˜**ï¼š
- å¤§åœ°å›¾ï¼ˆWorld Mapï¼‰ï¼šå±•ç¤ºä¸–ç•Œ/åŒºåŸŸï¼Œé˜Ÿä¼ä½ç½®ï¼Œåœ°ç‚¹æ ‡è®°
- æˆ˜æ–—åœ°å›¾ï¼ˆBattle Mapï¼‰ï¼šå…·ä½“åœºæ™¯ï¼Œæ ¼å­åŒ–ï¼Œæ”¯æŒ Token ç§»åŠ¨å’Œæˆ˜æ–—
- `enter_battle_map`ï¼šä»å¤§åœ°å›¾è¿›å…¥æˆ˜æ–—åœ°å›¾
- `exit_battle_map`ï¼šç¦»å¼€æˆ˜æ–—åœ°å›¾ï¼Œå›åˆ°å¤§åœ°å›¾

### 5.1 åœ°å›¾ç³»ç»Ÿè®¾è®¡ï¼ˆâœ… å·²å†³ç­–ï¼‰

**æ ¸å¿ƒç†å¿µï¼šåŸºäºæ ¼å­çš„ç»Ÿä¸€ç³»ç»Ÿ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»Ÿä¸€æ ¼å­ç³»ç»Ÿ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  æ¥è‡ª UVTTï¼š                                                     â”‚
â”‚    â””â”€ æ ¼å­æ¦‚å¿µï¼ˆå°ºå¯¸ã€åæ ‡ç³»ï¼‰                                   â”‚
â”‚                                                                  â”‚
â”‚  è‡ªå®šä¹‰ï¼š                                                        â”‚
â”‚    â””â”€ æ¯ä¸ªæ ¼å­çš„å†…å®¹ï¼ˆé“è·¯ã€æ£®æ—ã€å¢™å£ã€ç©ºåœ°...ï¼‰                â”‚
â”‚                                                                  â”‚
â”‚  æˆ˜æ–—åœ°å›¾ vs å¤§åœ°å›¾ï¼š                                            â”‚
â”‚    â””â”€ æ ¼å­å†…å®¹ä¸åŒï¼Œä½†æ ¼å­ç³»ç»Ÿç»Ÿä¸€                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»Ÿä¸€æ•°æ®ç»“æ„**ï¼š

```go
{
  "id": "map-001",
  "name": "...",
  "type": "world" | "battle",

  // æ¥è‡ª UVTTï¼šæ ¼å­åŸºç¡€ä¿¡æ¯
  "grid": {
    "width": 100,           // æ ¼å­æ•°
    "height": 80,
    "cell_size": 5          // æ¯æ ¼å•ä½ï¼ˆè‹±å°º/æ¸¸æˆå•ä½ï¼‰
  },

  // è‡ªå®šä¹‰ï¼šæ¯ä¸ªæ ¼å­çš„å†…å®¹
  // æˆ˜æ–—åœ°å›¾ï¼šempty, wall, difficult_terrain, door...
  // å¤§åœ°å›¾ï¼šroad, forest, water, mountain, building...
  "cells": [...],

  // åœ°ç‚¹/æ ‡è®°
  "locations": [...],

  // Token ä½ç½®
  "tokens": [...]
}
```

**è®¾è®¡åŸåˆ™**ï¼š
1. **åªå– UVTT æ ¼å­æ¦‚å¿µ**ï¼šå¤ç”¨æ ¼å­è§£æé€»è¾‘
2. **æ ¼å­å†…å®¹è‡ªå®šä¹‰**ï¼šé“è·¯ã€åœ°å½¢ç­‰è‡ªè¡Œå®šä¹‰
3. **å›¾ç‰‡å‰ç«¯ç®¡ç†**ï¼šServer åªå­˜æ•°æ®ï¼Œå›¾ç‰‡ç”±å‰ç«¯å­˜å‚¨
4. **åŒåœ°å›¾ç»Ÿä¸€æ ¼å­ç³»ç»Ÿ**ï¼šå¤§åœ°å›¾å’Œæˆ˜æ–—åœ°å›¾å…±äº«åæ ‡ç³»

### 6. è§„åˆ™æŸ¥è¯¢ï¼ˆLookupï¼‰- ä¾èµ– RAG

```go
// æŸ¥è¯¢æ³•æœ¯
lookup_spell(spell_name: string) â†’ spell_info

// æŸ¥è¯¢ç‰©å“
lookup_item(item_name: string) â†’ item_info

// æŸ¥è¯¢æ€ªç‰©
lookup_monster(monster_name: string) â†’ monster_info
```

### è®¾è®¡åŸåˆ™

1. **ä» Client è§’åº¦è®¾è®¡**ï¼šMCP Tools æ˜¯ Client éœ€è¦æ‰§è¡Œçš„ä¸šåŠ¡æ“ä½œ
2. **éšè—å†…éƒ¨å®ç°**ï¼šå¯¹è¯å­˜å‚¨ã€ä¸Šä¸‹æ–‡æ„å»ºç­‰ç”± Server è‡ªåŠ¨å¤„ç†
3. **HP å˜åŒ–æ˜¯å‰¯ä½œç”¨**ï¼šattack()ã€cast_spell() çš„ç»“æœåŒ…å« HP å˜åŒ–ï¼Œæ— éœ€å•ç‹¬å·¥å…·
4. **æ—¶é—´æ¨è¿›æ˜¯å‰¯ä½œç”¨**ï¼šmove_to() è‡ªåŠ¨æ¶ˆè€—æ—¶é—´ï¼Œget_campaign_summary() è¿”å›å½“å‰æ—¶é—´

---

## ä¸‰ã€é—ç•™é—®é¢˜

| é—®é¢˜ | é‡è¦æ€§ | è¯´æ˜ |
|------|--------|------|
| **çŠ¶æ€æ•ˆæœç³»ç»Ÿ** | ğŸŸ¡ ä¸­ | apply_condition/remove_conditionï¼Œåç»­è¡¥å…… |
| **ä¸Šä¸‹æ–‡é«˜çº§å‹ç¼©** | ğŸŸ¢ ä½ | æ‘˜è¦ç­–ç•¥ï¼Œéœ€è¦ LLMï¼Œå¯åç»­æ‰©å±• |

### é—ç•™é—®é¢˜è¯¦æƒ…

#### 1. çŠ¶æ€æ•ˆæœç³»ç»Ÿï¼ˆåç»­è¡¥å……ï¼‰

å½“å‰æš‚ä¸å®ç°ï¼Œåç»­è¡¥å……ï¼š
- `apply_condition(character_id, condition, duration)`
- `remove_condition(character_id, condition)`
- çŠ¶æ€æ•ˆæœï¼šä¸­æ¯’ã€éº»ç—¹ã€å¤±æ˜ç­‰

#### 2. ä¸Šä¸‹æ–‡é«˜çº§å‹ç¼©ï¼ˆåç»­æ‰©å±•ï¼‰

å½“å‰ä½¿ç”¨ç®€å•çš„æ»‘åŠ¨çª—å£ç­–ç•¥ï¼Œæœªæ¥å¯æ‰©å±•ï¼š
- æ‘˜è¦ + æœ€è¿‘æ¶ˆæ¯ç­–ç•¥
- é‡è¦æ€§åŠ æƒç­–ç•¥
- éœ€è¦ç”± Client çš„ LLM èƒ½åŠ›æ”¯æŒ

---

## å››ã€å‡è®¾

| å‡è®¾ | ç†ç”± |
|------|------|
| ä½¿ç”¨ Go è¯­è¨€ | ä¸ Client æŠ€æœ¯æ ˆä¸€è‡´ |
| è§„åˆ™å¼•æ“æ˜¯æ— çŠ¶æ€çš„ | æ‰€æœ‰çŠ¶æ€ç”±ä¸Šä¸‹æ–‡ç®¡ç†å±‚æŒä¹…åŒ– |
| Server éœ€æ”¯æŒå¤š Client è¿æ¥ | åŸºäº"ç‹¬ç«‹æœåŠ¡"çš„å®šä½ |
| ä¼šè¯æ•°æ®éœ€è¦æŒä¹…åŒ– | Server é‡å¯åèƒ½æ¢å¤ |
| Server ä¸ä¾èµ– LLM | ä¿æŒç®€å•ï¼ŒLLM èƒ½åŠ›ç”± Client æä¾› |

---

## äº”ã€çº¦æŸ

### æŠ€æœ¯çº¦æŸ

- Go è¯­è¨€å®ç°
- PostgreSQL æ•°æ®åº“
- MCP åè®® + HTTP ä¼ è¾“
- Server ä¸ä¾èµ– LLM

### ä¸šåŠ¡çº¦æŸ

- æœ€ç»ˆæ”¯æŒå®Œæ•´ 5e è§„åˆ™
- å…¼å®¹å…¶ä»– MCP Client
- å›åˆåˆ¶æˆ˜æ–—

### è®¾è®¡çº¦æŸ

- æš‚ä¸è€ƒè™‘è§„åˆ™å¯é€‰/å†²çª
- æš‚ä¸æ”¯æŒåœ°å›¾ç¼–è¾‘
- æˆ˜æ–— AI ä¸åœ¨ Server å®ç°

---

## å…­ã€ä¸‹ä¸€æ­¥

1. **å®Œæˆ Server éœ€æ±‚è§„æ ¼æ–‡æ¡£**
   - åŸºäºå·²ç¡®å®šçš„æŠ€æœ¯å†³ç­–
   - è®¾è®¡æ•°æ®æ¨¡å‹
   - è¯¦ç»†çš„ API å®šä¹‰

2. **åç»­æ‰©å±•é¡¹**
   - çŠ¶æ€æ•ˆæœç³»ç»Ÿ
   - ä¸Šä¸‹æ–‡é«˜çº§å‹ç¼©
   - åœ°å›¾æ ¼å­å†…å®¹ç¼–è¾‘å·¥å…·

---

## ä¸ƒã€è®¨è®ºè®°å½•

| æ—¥æœŸ | è®¨è®ºå†…å®¹ | ç»“è®º |
|------|----------|------|
| 2025-02-14 | æ¶æ„å®šä½ã€åˆ†å±‚è®¾è®¡ã€è§„åˆ™è¦†ç›–ã€ä¼šè¯å­˜å‚¨ã€äº¤äº’æµç¨‹ | è§"æ ¸å¿ƒå†³ç­– 1-4" |
| 2025-02-14 | å¯¹è¯å†å²å­˜å‚¨ä½ç½® | âœ… å·²å†³ç­–ï¼šServer ç»Ÿä¸€å­˜å‚¨ |
| 2025-02-14 | Server LLM ä¾èµ– | âœ… å·²å†³ç­–ï¼šä¸ä¾èµ–ï¼Œä¿æŒç®€å• |
| 2025-02-14 | ä¸Šä¸‹æ–‡å‹ç¼©ç­–ç•¥ | âœ… å·²å†³ç­–ï¼šæ»‘åŠ¨çª—å£ï¼Œé»˜è®¤ 20 æ¡ |
| 2025-02-14 | ä¸¤ç§ Client æ¨¡å¼ | âœ… å·²å†³ç­–ï¼šå®Œæ•´æ¨¡å¼ + ç®€åŒ–æ¨¡å¼ |
| 2025-02-14 | MCP Tools è®¾è®¡åŸåˆ™ | âœ… å·²å†³ç­–ï¼šä» Client è§’åº¦è®¾è®¡ï¼Œéšè—å†…éƒ¨å®ç° |
| 2025-02-14 | MCP Tools åˆ†ç±» | âœ… å·²å†³ç­–ï¼šæˆ˜å½¹ç®¡ç†ã€è§’è‰²ç®¡ç†ã€éª°å­/æ£€å®šã€æˆ˜æ–—æ“ä½œã€åœ°å›¾/ç§»åŠ¨ã€è§„åˆ™æŸ¥è¯¢ |
| 2025-02-14 | NPC å¤„ç† | âœ… å·²å†³ç­–ï¼šä¸è§’è‰²å…±äº«ç»„ä»¶ï¼Œé€šè¿‡ is_npc æ ‡è®°åŒºåˆ† |
| 2025-02-14 | å›åˆç®¡ç† | âœ… å·²å†³ç­–ï¼šstart_combat è‡ªåŠ¨æŠ•å…ˆæ”»ï¼Œget_combat_state + end_turn ç®¡ç†å›åˆ |
| 2025-02-14 | åœ°å›¾åˆ‡æ¢ | âœ… å·²å†³ç­–ï¼šå¤§åœ°å›¾ â†” æˆ˜æ–—åœ°å›¾ï¼Œenter_battle_map / exit_battle_map |
| 2025-02-14 | è§’è‰²çŠ¶æ€/æ¸¸æˆæ—¶é—´å·¥å…· | âœ… å·²å†³ç­–ï¼šç§»é™¤ï¼ŒHP å’Œæ—¶é—´å˜åŒ–ä½œä¸ºå…¶ä»–æ“ä½œçš„å‰¯ä½œç”¨ |
| 2025-02-14 | UVTT åœ°å›¾æ ¼å¼ | âœ… å·²å†³ç­–ï¼šåªå–æ ¼å­æ¦‚å¿µï¼Œå†…å®¹è‡ªå®šä¹‰ï¼Œå›¾ç‰‡å‰ç«¯ç®¡ç† |
| 2025-02-14 | åœ°å›¾ç³»ç»Ÿç»Ÿä¸€ | âœ… å·²å†³ç­–ï¼šå¤§åœ°å›¾å’Œæˆ˜æ–—åœ°å›¾ä½¿ç”¨ç»Ÿä¸€æ ¼å­ç³»ç»Ÿ |
