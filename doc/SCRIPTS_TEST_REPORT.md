# build.bat å’Œ test.bat æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2026-02-01
**æµ‹è¯•ç¯å¢ƒ**: Windows PowerShell

---

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. ä¿®å¤æµ‹è¯•ä»£ç 

#### internal/store/postgres_test.go
**ä¿®å¤çš„é—®é¢˜**:
- âœ… å°† `GameTime` å­—æ®µç±»å‹ä» `time.Now()` (time.Time) ä¿®æ”¹ä¸º `"Morning"` (string)
- âœ… å°†æ–¹æ³•åä» `ListMessages` ä¿®æ”¹ä¸º `GetMessages`ï¼Œå¹¶æ·»åŠ æ­£ç¡®çš„å‚æ•° `(ctx, sessionID, 100, 0)`
- âœ… å…±ä¿®å¤ 6 å¤„é”™è¯¯

**æµ‹è¯•ç»“æœ**:
- ç¼–è¯‘: âœ… é€šè¿‡
- è¿è¡Œ: âš ï¸ éœ€è¦çœŸå® PostgreSQL æ•°æ®åº“

#### internal/api/handler/chat_test.go
**ä¿®å¤çš„é—®é¢˜**:
- âœ… æ·»åŠ  `StreamCompletion` æ–¹æ³•åˆ° MockLLMClientï¼Œå®ç° llm.Client æ¥å£
- âœ… ä¿®å¤ store åˆå§‹åŒ–ï¼šä½¿ç”¨ `store.NewPostgresStore(databaseURL)` æ›¿ä»£ç©ºç»“æ„ä½“
- âœ… ä¿®å¤ TestChatHandler_ChatMessage_ToolCalls æµ‹è¯•ï¼Œä¸ç›´æ¥è®¿é—®ç§æœ‰å­—æ®µ `llmClient`
- âœ… åˆ é™¤æœªä½¿ç”¨çš„ import `"github.com/dnd-mcp/client/internal/models"`
- âœ… å°†æœªä½¿ç”¨çš„ `db` å˜é‡æ›¿æ¢ä¸º `_`

**æµ‹è¯•ç»“æœ**:
- ç¼–è¯‘: âœ… é€šè¿‡
- è¿è¡Œ: âš ï¸ éœ€è¦çœŸå® PostgreSQL æ•°æ®åº“

### 2. æ•´ç†æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶å¤¹

**åˆ›å»ºçš„æ–‡ä»¶å¤¹ç»“æ„**:
```
test-reports/
â”œâ”€â”€ .gitignore              # å¿½ç•¥æ‰€æœ‰æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶
â”œâ”€â”€ coverage.html           # HTML è¦†ç›–ç‡æŠ¥å‘Š
â”œâ”€â”€ coverage.out            # è¦†ç›–ç‡æ•°æ®
â”œâ”€â”€ coverage_generation.txt # è¦†ç›–ç‡ç”Ÿæˆæ—¥å¿—
â”œâ”€â”€ test_output.txt         # æµ‹è¯•è¾“å‡ºæ—¥å¿—
â””â”€â”€ test_report.txt         # æµ‹è¯•æŠ¥å‘Šæ‘˜è¦
```

### 3. ä¿®æ”¹ test.bat è„šæœ¬

**æ›´æ”¹å†…å®¹**:
- âœ… æ‰€æœ‰æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶ç°åœ¨è¾“å‡ºåˆ° `test-reports/` æ–‡ä»¶å¤¹
- âœ… è‡ªåŠ¨åˆ›å»º `test-reports/` æ–‡ä»¶å¤¹
- âœ… æ¸…ç†æ—§çš„æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶
- âœ… æµ‹è¯•æŠ¥å‘Šè·¯å¾„æ›´æ–°

**ä¿®æ”¹çš„è·¯å¾„**:
- `coverage.out` â†’ `test-reports\coverage.out`
- `coverage.html` â†’ `test-reports\coverage.html`
- `test_output.txt` â†’ `test-reports\test_output.txt`
- `test_report.txt` â†’ `test-reports\test_report.txt`

### 4. PowerShell æµ‹è¯•è„šæœ¬

**åˆ›å»ºçš„æ–‡ä»¶**: `test-scripts.ps1`

**åŠŸèƒ½**:
- éªŒè¯ build.bat å’Œ test.bat å­˜åœ¨
- æµ‹è¯• build.bat çš„æ„å»ºåŠŸèƒ½
- æµ‹è¯• test.bat çš„å•å…ƒæµ‹è¯•åŠŸèƒ½
- æ˜¾ç¤ºä½¿ç”¨è¯´æ˜

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### build.bat æµ‹è¯•
```
âœ“ build å­˜åœ¨
âœ“ æ„å»ºæˆåŠŸ
âœ“ ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶: bin\dnd-mcp-client.exe (14 MB)
```

### test.bat æµ‹è¯•
```
âœ“ test.bat å­˜åœ¨
âœ“ LLM å®¢æˆ·ç«¯æµ‹è¯•: 11/11 é€šè¿‡
âœ“ æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆåˆ° test-reports/ æ–‡ä»¶å¤¹
âœ“ è¦†ç›–ç‡æŠ¥å‘Šå·²ç”Ÿæˆ
```

### æµ‹è¯•è¦†ç›–
- âœ… **LLM å®¢æˆ·ç«¯æµ‹è¯•**: 11/11 é€šè¿‡ (100%)
- âš ï¸ **å­˜å‚¨å±‚æµ‹è¯•**: ç¼–è¯‘é€šè¿‡ï¼Œéœ€è¦æ•°æ®åº“
- âš ï¸ **Handler æµ‹è¯•**: ç¼–è¯‘é€šè¿‡ï¼Œéœ€è¦æ•°æ®åº“
- âš ï¸ **é›†æˆæµ‹è¯•**: éœ€è¦æ•°æ®åº“ç¯å¢ƒ

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### åœ¨ PowerShell ä¸­è¿è¡Œ

#### æ„å»º
```powershell
.\build.bat build          # æ„å»ºåº”ç”¨
.\build.bat run            # è¿è¡Œåº”ç”¨
.\build.bat clean          # æ¸…ç†æ„å»ºæ–‡ä»¶
.\build.bat help           # æ˜¾ç¤ºå¸®åŠ©
```

#### æµ‹è¯•
```powershell
.\test.bat                 # è¿è¡Œæ‰€æœ‰æµ‹è¯•
.\test.bat --unit          # ä»…è¿è¡Œå•å…ƒæµ‹è¯•
.\test.bat --integration   # ä»…è¿è¡Œé›†æˆæµ‹è¯•
.\test.bat --no-coverage   # ä¸ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
.\test.bat --race          # å¯ç”¨ç«æ€æ£€æµ‹
.\test.bat --help          # æ˜¾ç¤ºå¸®åŠ©
```

### åœ¨ CMD ä¸­è¿è¡Œ
å‘½ä»¤ç›¸åŒï¼Œç›´æ¥ä½¿ç”¨ `.bat` æ–‡ä»¶åå³å¯ã€‚

---

## ğŸ“ æ–‡ä»¶ç»„ç»‡

```
dnd-mcp/
â”œâ”€â”€ build.bat              # æ„å»ºè„šæœ¬
â”œâ”€â”€ test.bat               # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ test-scripts.ps1       # PowerShell æµ‹è¯•éªŒè¯è„šæœ¬
â”œâ”€â”€ test-reports/          # æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶å¤¹ (ä¸æäº¤åˆ° Git)
â”‚   â”œâ”€â”€ .gitignore
â”‚   â”œâ”€â”€ coverage.html
â”‚   â”œâ”€â”€ coverage.out
â”‚   â”œâ”€â”€ test_output.txt
â”‚   â””â”€â”€ test_report.txt
â””â”€â”€ doc/
    â””â”€â”€ SCRIPTS_TEST_REPORT.md  # æœ¬æ–‡æ¡£
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ•°æ®åº“ä¾èµ–
ä»¥ä¸‹æµ‹è¯•éœ€è¦çœŸå®çš„ PostgreSQL æ•°æ®åº“ï¼š
- `internal/store/postgres_test.go` - æ‰€æœ‰ 6 ä¸ªæµ‹è¯•
- `internal/api/handler/chat_test.go` - æ‰€æœ‰ 6 ä¸ªæµ‹è¯•
- `tests/integration/chat_integration_test.go` - æ‰€æœ‰ 5 ä¸ªæµ‹è¯•

**æ•°æ®åº“é…ç½®**:
- ä¸»æœº: localhost:5432
- æ•°æ®åº“: dnd_mcp_test
- ç”¨æˆ·å: postgres
- å¯†ç : postgres

**å¦‚ä½•è¿è¡Œéœ€è¦æ•°æ®åº“çš„æµ‹è¯•**:
1. å®‰è£… PostgreSQL
2. åˆ›å»ºæµ‹è¯•æ•°æ®åº“: `createdb -U postgres dnd_mcp_test`
3. è¿è¡Œæµ‹è¯•: `.\test.bat`

### ä¸éœ€è¦æ•°æ®åº“çš„æµ‹è¯•
- âœ… `internal/client/llm/openai_test.go` - æ‰€æœ‰ 11 ä¸ªæµ‹è¯•éƒ½èƒ½è¿è¡Œ
  - ä½¿ç”¨ httptest æ¨¡æ‹Ÿ HTTP æœåŠ¡å™¨
  - ä¸éœ€è¦å¤–éƒ¨ä¾èµ–

---

## âœ¨ æ”¹è¿›äº®ç‚¹

1. **ç»Ÿä¸€çš„æŠ¥å‘Šç®¡ç†**
   - æ‰€æœ‰æµ‹è¯•æŠ¥å‘Šé›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹
   - ä¾¿äºæ¸…ç†å’Œç®¡ç†
   - ä¸ä¼šè¢«æäº¤åˆ° Git

2. **PowerShell å…¼å®¹æ€§**
   - ä¸¤ä¸ª bat æ–‡ä»¶éƒ½å¯ä»¥åœ¨ PowerShell ä¸­ç›´æ¥è¿è¡Œ
   - æä¾› PowerShell æµ‹è¯•è„šæœ¬

3. **å®Œæ•´çš„æµ‹è¯•è¦†ç›–**
   - 27+ æµ‹è¯•ç”¨ä¾‹
   - è¦†ç›–ç‡æŠ¥å‘Š (coverage.html)
   - è¯¦ç»†çš„æµ‹è¯•è¾“å‡º (test_output.txt)

4. **çµæ´»çš„æµ‹è¯•é€‰é¡¹**
   - æ”¯æŒä»…è¿è¡Œå•å…ƒæµ‹è¯•
   - æ”¯æŒä»…è¿è¡Œé›†æˆæµ‹è¯•
   - æ”¯æŒç«æ€æ£€æµ‹
   - æ”¯æŒè·³è¿‡è¦†ç›–ç‡ç”Ÿæˆ

---

## ğŸ‰ æ€»ç»“

âœ… **build.bat**: åŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥æ„å»ºåº”ç”¨
âœ… **test.bat**: åŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥è¿è¡Œæµ‹è¯•
âœ… **PowerShell**: ä¸¤ä¸ªè„šæœ¬éƒ½å¯ä»¥åœ¨ PowerShell ä¸­ç›´æ¥è¿è¡Œ
âœ… **æµ‹è¯•æŠ¥å‘Š**: ç»Ÿä¸€æ•´ç†åˆ° test-reports/ æ–‡ä»¶å¤¹
âœ… **ä»£ç ä¿®å¤**: æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤

**çŠ¶æ€**: ğŸŸ¢ å°±ç»ª

**ä¸‹ä¸€æ­¥**:
- å¦‚éœ€è¿è¡Œéœ€è¦æ•°æ®åº“çš„æµ‹è¯•ï¼Œè¯·å…ˆé…ç½® PostgreSQL
- æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š: æ‰“å¼€ `test-reports/coverage.html`
- æŸ¥çœ‹è¯¦ç»†è¾“å‡º: æŸ¥çœ‹ `test-reports/test_output.txt`
